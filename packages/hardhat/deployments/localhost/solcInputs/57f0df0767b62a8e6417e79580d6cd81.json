{
  "language": "Solidity",
  "sources": {
    "contracts/AgeRestrictionVerifier.sol": {
      "content": "// SPDX-License-Identifier: MIT\r\npragma solidity ^0.8.20;\r\n\r\ninterface IZkProofVerifier {\r\n    function verifyProof(\r\n        uint256[2] memory a,\r\n        uint256[2][2] memory b,\r\n        uint256[2] memory c,\r\n        uint256[5] memory input\r\n    ) external view returns (bool);\r\n}\r\n\r\ncontract AgeRestrictionVerifier {\r\n    IZkProofVerifier public zkProofVerifier;\r\n    \r\n    enum AgeRestriction { NONE, AGE_18, AGE_21, AGE_25 }\r\n    \r\n    // Maps (userAddress, eventId) => verified age group\r\n    mapping(address => mapping(uint256 => bool)) public isAgeVerified;\r\n    \r\n    // Maps (userAddress, eventId) => ZK proof hash (for audit trail)\r\n    mapping(address => mapping(uint256 => bytes32)) public proofHash;\r\n    \r\n    event AgeVerificationSuccessful(\r\n        address indexed user,\r\n        uint256 indexed eventId,\r\n        AgeRestriction ageGroup\r\n    );\r\n    \r\n    constructor(address _zkProofVerifier) {\r\n        zkProofVerifier = IZkProofVerifier(_zkProofVerifier);\r\n    }\r\n    \r\n    /**\r\n     * Verify age via zero-knowledge proof\r\n     * Input[0] = aadharHash\r\n     * Input[1] = publicAgeGroup (0, 1, 2, 3)\r\n     * Input[2] = isAdult\r\n     * Input[3] = ageGroupCommit\r\n     * Input[4] = currentTimestamp\r\n     */\r\n    function verifyAge(\r\n        uint256[2] memory a,\r\n        uint256[2][2] memory b,\r\n        uint256[2] memory c,\r\n        uint256[5] memory input, // Updated to 5 public signals\r\n        uint256 eventId,\r\n        AgeRestriction requiredAgeGroup\r\n    ) external returns (bool) {\r\n        // Verify ZK proof\r\n        require(\r\n            zkProofVerifier.verifyProof(a, b, c, input),\r\n            \"Invalid age proof\"\r\n        );\r\n        \r\n        // Verify event age requirement\r\n        uint256 provedAgeGroup = input[1];\r\n        require(provedAgeGroup >= uint256(requiredAgeGroup), \"Age requirement not met\");\r\n        \r\n        // Mark user as verified (without storing age or Aadhaar)\r\n        isAgeVerified[msg.sender][eventId] = true;\r\n        \r\n        // Store proof hash for audit trail\r\n        proofHash[msg.sender][eventId] = keccak256(\r\n            abi.encode(a, b, c, input)\r\n        );\r\n        \r\n        emit AgeVerificationSuccessful(\r\n            msg.sender,\r\n            eventId,\r\n            AgeRestriction(provedAgeGroup)\r\n        );\r\n        \r\n        return true;\r\n    }\r\n    \r\n    /**\r\n     * Check if user is age-verified for an event\r\n     * Returns true/false without revealing age\r\n     */\r\n    function isVerifiedForEvent(address user, uint256 eventId) \r\n        external \r\n        view \r\n        returns (bool) \r\n    {\r\n        return isAgeVerified[user][eventId];\r\n    }\r\n}\r\n"
    }
  },
  "settings": {
    "optimizer": {
      "enabled": true,
      "runs": 200
    },
    "viaIR": true,
    "evmVersion": "paris",
    "outputSelection": {
      "*": {
        "*": [
          "abi",
          "evm.bytecode",
          "evm.deployedBytecode",
          "evm.methodIdentifiers",
          "metadata",
          "devdoc",
          "userdoc",
          "storageLayout",
          "evm.gasEstimates"
        ],
        "": [
          "ast"
        ]
      }
    },
    "metadata": {
      "useLiteralContent": true
    }
  }
}